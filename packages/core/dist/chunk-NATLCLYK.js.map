{"version":3,"sources":["../src/services/form-collection-sync.ts","../src/middleware/bootstrap.ts","../src/middleware/auth.ts","../src/middleware/metrics.ts","../src/middleware/index.ts"],"names":[],"mappings":"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","file":"chunk-NATLCLYK.js","sourcesContent":["/**\n * Form-Collection Sync Service\n *\n * Bridge logic that creates \"shadow collections\" for forms and\n * dual-writes form submissions to the content table, enabling\n * unified content management for form submissions.\n */\n\nconst SYSTEM_FORM_USER_ID = 'system-form-submission'\n\n/**\n * Convert Form.io component type to collection schema field type\n */\nfunction mapFormioTypeToSchemaType(component: any): { type: string; [key: string]: any } {\n  switch (component.type) {\n    case 'textfield':\n    case 'textarea':\n    case 'password':\n    case 'phoneNumber':\n    case 'url':\n      return { type: 'string', title: component.label || component.key }\n    case 'email':\n      return { type: 'string', format: 'email', title: component.label || component.key }\n    case 'number':\n    case 'currency':\n      return { type: 'number', title: component.label || component.key }\n    case 'checkbox':\n      return { type: 'boolean', title: component.label || component.key }\n    case 'select':\n    case 'radio': {\n      const enumValues = (component.data?.values || component.values || []).map((v: any) => v.value)\n      const enumLabels = (component.data?.values || component.values || []).map((v: any) => v.label)\n      return {\n        type: 'select',\n        title: component.label || component.key,\n        enum: enumValues,\n        enumLabels\n      }\n    }\n    case 'selectboxes':\n      return { type: 'object', title: component.label || component.key }\n    case 'datetime':\n    case 'day':\n    case 'time':\n      return { type: 'string', format: 'date-time', title: component.label || component.key }\n    case 'file':\n    case 'signature':\n      return { type: 'string', title: component.label || component.key }\n    case 'address':\n      return { type: 'object', title: component.label || component.key }\n    case 'hidden':\n      return { type: 'string', title: component.label || component.key }\n    default:\n      return { type: 'string', title: component.label || component.key }\n  }\n}\n\n/**\n * Recursively extract field components from a Form.io schema,\n * skipping layout-only components (panels, columns, fieldsets, etc.)\n */\nfunction extractFieldComponents(components: any[]): any[] {\n  const fields: any[] = []\n  if (!components) return fields\n\n  for (const comp of components) {\n    // Layout components — recurse into children\n    if (comp.type === 'panel' || comp.type === 'fieldset' || comp.type === 'well' || comp.type === 'tabs') {\n      if (comp.components) {\n        fields.push(...extractFieldComponents(comp.components))\n      }\n      continue\n    }\n    if (comp.type === 'columns' && comp.columns) {\n      for (const col of comp.columns) {\n        if (col.components) {\n          fields.push(...extractFieldComponents(col.components))\n        }\n      }\n      continue\n    }\n    if (comp.type === 'table' && comp.rows) {\n      for (const row of comp.rows) {\n        if (Array.isArray(row)) {\n          for (const cell of row) {\n            if (cell.components) {\n              fields.push(...extractFieldComponents(cell.components))\n            }\n          }\n        }\n      }\n      continue\n    }\n    // Skip buttons and non-input layout elements\n    if (comp.type === 'button' || comp.type === 'htmlelement' || comp.type === 'content') {\n      continue\n    }\n    // Skip turnstile (not data)\n    if (comp.type === 'turnstile') {\n      continue\n    }\n    // It's a real field\n    if (comp.key) {\n      fields.push(comp)\n    }\n    // Recurse into sub-components for containers\n    if (comp.components) {\n      fields.push(...extractFieldComponents(comp.components))\n    }\n  }\n  return fields\n}\n\n/**\n * Convert a Form.io schema into a collection JSON schema definition\n */\nexport function deriveCollectionSchemaFromFormio(formioSchema: any): any {\n  const components = formioSchema?.components || []\n  const fieldComponents = extractFieldComponents(components)\n\n  const properties: Record<string, any> = {\n    // Always include a title field for the content item\n    title: { type: 'string', title: 'Title', required: true }\n  }\n  const required: string[] = ['title']\n\n  for (const comp of fieldComponents) {\n    const key = comp.key\n    if (!key || key === 'submit' || key === 'title') continue\n    const fieldDef = mapFormioTypeToSchemaType(comp)\n    if (comp.validate?.required) {\n      fieldDef.required = true\n      required.push(key)\n    }\n    properties[key] = fieldDef\n  }\n\n  return { type: 'object', properties, required }\n}\n\n/**\n * Derive a human-readable title from form submission data\n */\nexport function deriveSubmissionTitle(data: Record<string, any>, formDisplayName: string): string {\n  // Try common fields in order of preference\n  const candidates = ['name', 'fullName', 'full_name', 'firstName', 'first_name']\n  for (const key of candidates) {\n    if (data[key] && typeof data[key] === 'string' && data[key].trim()) {\n      // Append last name if available\n      if (key === 'firstName' || key === 'first_name') {\n        const last = data['lastName'] || data['last_name'] || data['lastname'] || ''\n        if (last) return `${data[key].trim()} ${last.trim()}`\n      }\n      return data[key].trim()\n    }\n  }\n  // Try email\n  if (data.email && typeof data.email === 'string' && data.email.trim()) {\n    return data.email.trim()\n  }\n  // Try subject\n  if (data.subject && typeof data.subject === 'string' && data.subject.trim()) {\n    return data.subject.trim()\n  }\n  // Fallback\n  const dateStr = new Date().toLocaleDateString('en-US', {\n    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\n  })\n  return `${formDisplayName} - ${dateStr}`\n}\n\n/**\n * Map form submission status to content status.\n * Form submissions are complete data — they default to 'published'.\n * Only rejected/spam submissions get demoted.\n */\nexport function mapFormStatusToContentStatus(formStatus: string): string {\n  switch (formStatus) {\n    case 'pending': return 'published'\n    case 'reviewed': return 'published'\n    case 'approved': return 'published'\n    case 'rejected': return 'archived'\n    case 'spam': return 'deleted'\n    default: return 'published'\n  }\n}\n\n/**\n * Create or update a shadow collection for a given form\n */\nexport async function syncFormCollection(db: D1Database, form: {\n  id: string\n  name: string\n  display_name: string\n  description?: string | null\n  formio_schema: any\n  is_active: number | boolean\n}): Promise<{ collectionId: string; status: 'created' | 'updated' | 'unchanged' }> {\n  const collectionName = `form_${form.name}`\n  const displayName = `${form.display_name} (Form)`\n\n  // Parse formio_schema\n  const formioSchema = typeof form.formio_schema === 'string'\n    ? JSON.parse(form.formio_schema)\n    : form.formio_schema\n\n  const schema = deriveCollectionSchemaFromFormio(formioSchema)\n  const schemaJson = JSON.stringify(schema)\n  const now = Date.now()\n  const isActive = form.is_active ? 1 : 0\n\n  // Check if shadow collection already exists\n  const existing = await db.prepare(\n    'SELECT id, schema, display_name, description, is_active FROM collections WHERE source_type = ? AND source_id = ?'\n  ).bind('form', form.id).first() as any\n\n  if (!existing) {\n    // Create new shadow collection\n    const collectionId = `col-form-${form.name}-${crypto.randomUUID().slice(0, 8)}`\n\n    await db.prepare(`\n      INSERT INTO collections (id, name, display_name, description, schema, is_active, managed, source_type, source_id, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, 1, 'form', ?, ?, ?)\n    `).bind(\n      collectionId,\n      collectionName,\n      displayName,\n      form.description || null,\n      schemaJson,\n      isActive,\n      form.id,\n      now,\n      now\n    ).run()\n\n    console.log(`[FormSync] Created shadow collection: ${collectionName}`)\n    return { collectionId, status: 'created' }\n  }\n\n  // Check if update needed\n  const existingSchema = existing.schema ? JSON.stringify(typeof existing.schema === 'string' ? JSON.parse(existing.schema) : existing.schema) : '{}'\n  const needsUpdate =\n    schemaJson !== existingSchema ||\n    displayName !== existing.display_name ||\n    (form.description || null) !== existing.description ||\n    isActive !== existing.is_active\n\n  if (!needsUpdate) {\n    return { collectionId: existing.id, status: 'unchanged' }\n  }\n\n  await db.prepare(`\n    UPDATE collections SET display_name = ?, description = ?, schema = ?, is_active = ?, updated_at = ?\n    WHERE id = ?\n  `).bind(\n    displayName,\n    form.description || null,\n    schemaJson,\n    isActive,\n    now,\n    existing.id\n  ).run()\n\n  console.log(`[FormSync] Updated shadow collection: ${collectionName}`)\n  return { collectionId: existing.id, status: 'updated' }\n}\n\n/**\n * Sync all active forms to shadow collections\n */\nexport async function syncAllFormCollections(db: D1Database): Promise<void> {\n  try {\n    // Check if forms table exists\n    const tableCheck = await db.prepare(\n      \"SELECT name FROM sqlite_master WHERE type='table' AND name='forms'\"\n    ).first()\n    if (!tableCheck) {\n      console.log('[FormSync] Forms table does not exist, skipping form sync')\n      return\n    }\n\n    const { results: forms } = await db.prepare(\n      'SELECT id, name, display_name, description, formio_schema, is_active FROM forms'\n    ).all()\n\n    if (!forms || forms.length === 0) {\n      console.log('[FormSync] No forms found, skipping')\n      return\n    }\n\n    let created = 0\n    let updated = 0\n\n    for (const form of forms) {\n      try {\n        const result = await syncFormCollection(db, form as any)\n        if (result.status === 'created') created++\n        if (result.status === 'updated') updated++\n\n        // Backfill existing submissions that don't have content_id\n        await backfillFormSubmissions(db, form.id as string, result.collectionId)\n      } catch (error) {\n        console.error(`[FormSync] Error syncing form ${form.name}:`, error)\n      }\n    }\n\n    console.log(`[FormSync] Sync complete: ${created} created, ${updated} updated out of ${forms.length} forms`)\n  } catch (error) {\n    console.error('[FormSync] Error syncing form collections:', error)\n  }\n}\n\n/**\n * Create a content item from a form submission\n */\nexport async function createContentFromSubmission(\n  db: D1Database,\n  submissionData: Record<string, any>,\n  form: { id: string; name: string; display_name: string },\n  submissionId: string,\n  metadata: {\n    ipAddress?: string | null\n    userAgent?: string | null\n    userEmail?: string | null\n    userId?: string | null\n  } = {}\n): Promise<string | null> {\n  try {\n    // Find the shadow collection\n    let collection = await db.prepare(\n      'SELECT id FROM collections WHERE source_type = ? AND source_id = ?'\n    ).bind('form', form.id).first() as any\n\n    if (!collection) {\n      // Shadow collection missing — try to create it on the fly\n      console.warn(`[FormSync] No shadow collection found for form ${form.name}, attempting to create...`)\n      try {\n        const fullForm = await db.prepare(\n          'SELECT id, name, display_name, description, formio_schema, is_active FROM forms WHERE id = ?'\n        ).bind(form.id).first() as any\n\n        if (fullForm) {\n          const schema = typeof fullForm.formio_schema === 'string'\n            ? JSON.parse(fullForm.formio_schema)\n            : fullForm.formio_schema\n          const result = await syncFormCollection(db, {\n            id: fullForm.id,\n            name: fullForm.name,\n            display_name: fullForm.display_name,\n            description: fullForm.description,\n            formio_schema: schema,\n            is_active: fullForm.is_active ?? 1\n          })\n          // Re-query the collection\n          collection = await db.prepare(\n            'SELECT id FROM collections WHERE source_type = ? AND source_id = ?'\n          ).bind('form', form.id).first() as any\n          console.log(`[FormSync] On-the-fly sync result: ${result.status}, collectionId: ${result.collectionId}`)\n        }\n      } catch (syncErr) {\n        console.error('[FormSync] On-the-fly shadow collection creation failed:', syncErr)\n      }\n\n      if (!collection) {\n        console.error(`[FormSync] Still no shadow collection for form ${form.name} after recovery attempt`)\n        return null\n      }\n    }\n\n    const contentId = crypto.randomUUID()\n    const now = Date.now()\n\n    const title = deriveSubmissionTitle(submissionData, form.display_name)\n    const slug = `submission-${submissionId.slice(0, 8)}`\n\n    // Build content data with embedded metadata\n    const contentData: Record<string, any> = {\n      title,\n      ...submissionData,\n      _submission_metadata: {\n        submissionId,\n        formId: form.id,\n        formName: form.name,\n        email: metadata.userEmail || submissionData.email || null,\n        ipAddress: metadata.ipAddress || null,\n        userAgent: metadata.userAgent || null,\n        submittedAt: now\n      }\n    }\n\n    const authorId = metadata.userId || SYSTEM_FORM_USER_ID\n\n    // Ensure the system user exists (D1 enforces foreign keys)\n    if (authorId === SYSTEM_FORM_USER_ID) {\n      const systemUser = await db.prepare('SELECT id FROM users WHERE id = ?').bind(SYSTEM_FORM_USER_ID).first()\n      if (!systemUser) {\n        console.log('[FormSync] System form user missing, creating...')\n        const sysNow = Date.now()\n        await db.prepare(`\n          INSERT OR IGNORE INTO users (id, email, username, first_name, last_name, password_hash, role, is_active, created_at, updated_at)\n          VALUES (?, ?, ?, ?, ?, NULL, 'viewer', 0, ?, ?)\n        `).bind(SYSTEM_FORM_USER_ID, 'system-forms@sonicjs.internal', 'system-forms', 'Form', 'Submission', sysNow, sysNow).run()\n      }\n    }\n\n    console.log(`[FormSync] Inserting content: id=${contentId}, collection=${collection.id}, slug=${slug}, title=${title}, author=${authorId}`)\n\n    await db.prepare(`\n      INSERT INTO content (id, collection_id, slug, title, data, status, author_id, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, 'published', ?, ?, ?)\n    `).bind(\n      contentId,\n      collection.id,\n      slug,\n      title,\n      JSON.stringify(contentData),\n      authorId,\n      now,\n      now\n    ).run()\n\n    // Link submission to content\n    await db.prepare(\n      'UPDATE form_submissions SET content_id = ? WHERE id = ?'\n    ).bind(contentId, submissionId).run()\n\n    console.log(`[FormSync] Content created successfully: ${contentId}`)\n    return contentId\n  } catch (error) {\n    console.error('[FormSync] Error creating content from submission:', error)\n    return null\n  }\n}\n\n/**\n * Backfill existing form submissions that don't have a content_id\n */\nexport async function backfillFormSubmissions(\n  db: D1Database,\n  formId: string,\n  collectionId: string\n): Promise<number> {\n  try {\n    const { results: submissions } = await db.prepare(\n      'SELECT id, submission_data, user_email, ip_address, user_agent, user_id, submitted_at FROM form_submissions WHERE form_id = ? AND content_id IS NULL'\n    ).bind(formId).all()\n\n    if (!submissions || submissions.length === 0) {\n      return 0\n    }\n\n    // Get form info\n    const form = await db.prepare(\n      'SELECT id, name, display_name FROM forms WHERE id = ?'\n    ).bind(formId).first() as any\n\n    if (!form) return 0\n\n    let count = 0\n    for (const sub of submissions) {\n      try {\n        const submissionData = typeof sub.submission_data === 'string'\n          ? JSON.parse(sub.submission_data as string)\n          : sub.submission_data\n\n        const contentId = await createContentFromSubmission(\n          db,\n          submissionData,\n          { id: form.id, name: form.name, display_name: form.display_name },\n          sub.id as string,\n          {\n            ipAddress: sub.ip_address as string | null,\n            userAgent: sub.user_agent as string | null,\n            userEmail: sub.user_email as string | null,\n            userId: sub.user_id as string | null\n          }\n        )\n        if (contentId) count++\n      } catch (error) {\n        console.error(`[FormSync] Error backfilling submission ${sub.id}:`, error)\n      }\n    }\n\n    if (count > 0) {\n      console.log(`[FormSync] Backfilled ${count} submissions for form ${formId}`)\n    }\n    return count\n  } catch (error) {\n    console.error('[FormSync] Error backfilling submissions:', error)\n    return 0\n  }\n}\n","import { Context, Next } from \"hono\";\nimport { syncCollections } from \"../services/collection-sync\";\nimport { syncAllFormCollections } from \"../services/form-collection-sync\";\nimport { MigrationService } from \"../services/migrations\";\nimport { PluginBootstrapService } from \"../services/plugin-bootstrap\";\nimport type { SonicJSConfig } from \"../app\";\n\ntype Bindings = {\n  DB: D1Database;\n  KV: KVNamespace;\n};\n\n// Track if bootstrap has been run in this worker instance\nlet bootstrapComplete = false;\n\n/**\n * Bootstrap middleware that ensures system initialization\n * Runs once per worker instance\n */\nexport function bootstrapMiddleware(config: SonicJSConfig = {}) {\n  return async (c: Context<{ Bindings: Bindings }>, next: Next) => {\n    // Skip if already bootstrapped in this worker instance\n    if (bootstrapComplete) {\n      return next();\n    }\n\n    // Skip bootstrap for static assets and health checks\n    const path = c.req.path;\n    if (\n      path.startsWith(\"/images/\") ||\n      path.startsWith(\"/assets/\") ||\n      path === \"/health\" ||\n      path.endsWith(\".js\") ||\n      path.endsWith(\".css\") ||\n      path.endsWith(\".png\") ||\n      path.endsWith(\".jpg\") ||\n      path.endsWith(\".ico\")\n    ) {\n      return next();\n    }\n\n    try {\n      console.log(\"[Bootstrap] Starting system initialization...\");\n\n      // 1. Run database migrations first\n      console.log(\"[Bootstrap] Running database migrations...\");\n      const migrationService = new MigrationService(c.env.DB);\n      await migrationService.runPendingMigrations();\n\n      // 2. Sync collection configurations\n      console.log(\"[Bootstrap] Syncing collection configurations...\");\n      try {\n        await syncCollections(c.env.DB);\n      } catch (error) {\n        console.error(\"[Bootstrap] Error syncing collections:\", error);\n        // Continue bootstrap even if collection sync fails\n      }\n\n      // 2b. Sync form collections (creates shadow collections for forms)\n      console.log(\"[Bootstrap] Syncing form collections...\");\n      try {\n        await syncAllFormCollections(c.env.DB);\n      } catch (error) {\n        console.error(\"[Bootstrap] Error syncing form collections:\", error);\n        // Continue bootstrap even if form collection sync fails\n      }\n\n      // 3. Bootstrap core plugins (unless disableAll is set)\n      if (!config.plugins?.disableAll) {\n        console.log(\"[Bootstrap] Bootstrapping core plugins...\");\n        const bootstrapService = new PluginBootstrapService(c.env.DB);\n\n        // Check if bootstrap is needed\n        const needsBootstrap = await bootstrapService.isBootstrapNeeded();\n        if (needsBootstrap) {\n          await bootstrapService.bootstrapCorePlugins();\n        }\n      } else {\n        console.log(\"[Bootstrap] Plugin bootstrap skipped (disableAll is true)\");\n      }\n\n      // Mark bootstrap as complete for this worker instance\n      bootstrapComplete = true;\n      console.log(\"[Bootstrap] System initialization completed\");\n    } catch (error) {\n      console.error(\"[Bootstrap] Error during system initialization:\", error);\n      // Don't prevent the app from starting, but log the error\n    }\n\n    return next();\n  };\n}\n\n/**\n * Reset bootstrap flag (useful for testing)\n */\nexport function resetBootstrap() {\n  bootstrapComplete = false;\n}\n","import { sign, verify } from 'hono/jwt'\nimport { Context, Next } from 'hono'\nimport { getCookie, setCookie } from 'hono/cookie'\n\ntype JWTPayload = {\n  userId: string\n  email: string\n  role: string\n  exp: number\n  iat: number\n}\n\n// JWT secret - in production this should come from environment variables\nconst JWT_SECRET = 'your-super-secret-jwt-key-change-in-production'\n\nexport class AuthManager {\n  static async generateToken(userId: string, email: string, role: string): Promise<string> {\n    const payload: JWTPayload = {\n      userId,\n      email,\n      role,\n      exp: Math.floor(Date.now() / 1000) + (60 * 60 * 24), // 24 hours\n      iat: Math.floor(Date.now() / 1000)\n    }\n    \n    return await sign(payload, JWT_SECRET, 'HS256')\n  }\n\n  static async verifyToken(token: string): Promise<JWTPayload | null> {\n    try {\n      const payload = await verify(token, JWT_SECRET, 'HS256') as JWTPayload\n      \n      // Check if token is expired\n      if (payload.exp < Math.floor(Date.now() / 1000)) {\n        return null\n      }\n      \n      return payload\n    } catch (error) {\n      console.error('Token verification failed:', error)\n      return null\n    }\n  }\n\n  static async hashPassword(password: string): Promise<string> {\n    // In Cloudflare Workers, we'll use Web Crypto API\n    const encoder = new TextEncoder()\n    const data = encoder.encode(password + 'salt-change-in-production')\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data)\n    const hashArray = Array.from(new Uint8Array(hashBuffer))\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('')\n  }\n\n  static async verifyPassword(password: string, hash: string): Promise<boolean> {\n    const passwordHash = await this.hashPassword(password)\n    return passwordHash === hash\n  }\n\n  /**\n   * Set authentication cookie - useful for plugins implementing alternative auth methods\n   * @param c - Hono context\n   * @param token - JWT token to set in cookie\n   * @param options - Optional cookie configuration\n   */\n  static setAuthCookie(c: Context, token: string, options?: {\n    maxAge?: number\n    secure?: boolean\n    httpOnly?: boolean\n    sameSite?: 'Strict' | 'Lax' | 'None'\n  }): void {\n    setCookie(c, 'auth_token', token, {\n      httpOnly: options?.httpOnly ?? true,\n      secure: options?.secure ?? true,\n      sameSite: options?.sameSite ?? 'Strict',\n      maxAge: options?.maxAge ?? (60 * 60 * 24) // 24 hours default\n    })\n  }\n}\n\n// Middleware to require authentication\nexport const requireAuth = () => {\n  return async (c: Context, next: Next) => {\n    try {\n      // Try to get token from Authorization header\n      let token = c.req.header('Authorization')?.replace('Bearer ', '')\n\n      // If no header token, try cookie\n      if (!token) {\n        token = getCookie(c, 'auth_token')\n      }\n\n      if (!token) {\n        // Check if this is a browser request (HTML accept header)\n        const acceptHeader = c.req.header('Accept') || ''\n        if (acceptHeader.includes('text/html')) {\n          return c.redirect('/auth/login?error=Please login to access the admin area')\n        }\n        return c.json({ error: 'Authentication required' }, 401)\n      }\n\n      // Try to get cached token verification from KV\n      const kv = c.env?.KV\n      let payload: JWTPayload | null = null\n\n      if (kv) {\n        const cacheKey = `auth:${token.substring(0, 20)}` // Use token prefix as key\n        const cached = await kv.get(cacheKey, 'json')\n        if (cached) {\n          payload = cached as JWTPayload\n        }\n      }\n\n      // If not cached, verify token\n      if (!payload) {\n        payload = await AuthManager.verifyToken(token)\n\n        // Cache the verified payload for 5 minutes\n        if (payload && kv) {\n          const cacheKey = `auth:${token.substring(0, 20)}`\n          await kv.put(cacheKey, JSON.stringify(payload), { expirationTtl: 300 })\n        }\n      }\n\n      if (!payload) {\n        // Check if this is a browser request (HTML accept header)\n        const acceptHeader = c.req.header('Accept') || ''\n        if (acceptHeader.includes('text/html')) {\n          return c.redirect('/auth/login?error=Your session has expired, please login again')\n        }\n        return c.json({ error: 'Invalid or expired token' }, 401)\n      }\n\n      // Add user info to context\n      c.set('user', payload)\n\n      return await next()\n    } catch (error) {\n      console.error('Auth middleware error:', error)\n      // Check if this is a browser request (HTML accept header)\n      const acceptHeader = c.req.header('Accept') || ''\n      if (acceptHeader.includes('text/html')) {\n        return c.redirect('/auth/login?error=Authentication failed, please login again')\n      }\n      return c.json({ error: 'Authentication failed' }, 401)\n    }\n  }\n}\n\n// Middleware to require specific role\nexport const requireRole = (requiredRole: string | string[]) => {\n  return async (c: Context, next: Next) => {\n    const user = c.get('user') as JWTPayload\n    \n    if (!user) {\n      // Check if this is a browser request (HTML accept header)\n      const acceptHeader = c.req.header('Accept') || ''\n      if (acceptHeader.includes('text/html')) {\n        return c.redirect('/auth/login?error=Please login to access the admin area')\n      }\n      return c.json({ error: 'Authentication required' }, 401)\n    }\n    \n    const roles = Array.isArray(requiredRole) ? requiredRole : [requiredRole]\n    \n    if (!roles.includes(user.role)) {\n      // Check if this is a browser request (HTML accept header)\n      const acceptHeader = c.req.header('Accept') || ''\n      if (acceptHeader.includes('text/html')) {\n        return c.redirect('/auth/login?error=You do not have permission to access this area')\n      }\n      return c.json({ error: 'Insufficient permissions' }, 403)\n    }\n    \n    return await next()\n  }\n}\n\n// Optional auth middleware (doesn't block if no token)\nexport const optionalAuth = () => {\n  return async (c: Context, next: Next) => {\n    try {\n      let token = c.req.header('Authorization')?.replace('Bearer ', '')\n      \n      if (!token) {\n        token = getCookie(c, 'auth_token')\n      }\n      \n      if (token) {\n        const payload = await AuthManager.verifyToken(token)\n        if (payload) {\n          c.set('user', payload)\n        }\n      }\n      \n      return await next()\n    } catch (error) {\n      // Don't block on auth errors in optional auth\n      console.error('Optional auth error:', error)\n      return await next()\n    }\n  }\n}\n","import { MiddlewareHandler } from 'hono'\nimport { metricsTracker } from '../utils/metrics'\n\n/**\n * Middleware to track all HTTP requests for real-time analytics\n * Excludes the metrics endpoint itself to avoid inflating the count\n */\nexport const metricsMiddleware = (): MiddlewareHandler => {\n  return async (c, next) => {\n    const path = new URL(c.req.url).pathname\n\n    // Don't track the metrics endpoint itself to avoid self-inflating counts\n    if (path !== '/admin/dashboard/api/metrics') {\n      metricsTracker.recordRequest()\n    }\n\n    // Continue with the request\n    await next()\n  }\n}\n","/**\n * Middleware Module Exports\n *\n * Request processing middleware for SonicJS\n *\n * Note: Most middleware is currently in the monolith and will be migrated later.\n * For now, we only export the bootstrap middleware which is used for system initialization.\n */\n\n// Bootstrap middleware\nexport { bootstrapMiddleware } from './bootstrap'\n\n// Auth middleware\nexport { AuthManager, requireAuth, requireRole, optionalAuth } from './auth'\n\n// Metrics middleware\nexport { metricsMiddleware } from './metrics'\n\n// Re-export types and functions that are referenced but implemented in monolith\n// These are placeholder exports to maintain API compatibility\nexport type Permission = string\nexport type UserPermissions = {\n  userId: string\n  permissions: Permission[]\n}\n\n// Middleware stubs - these return pass-through middleware that call next()\nexport const loggingMiddleware: any = () => async (_c: any, next: any) => await next()\nexport const detailedLoggingMiddleware: any = () => async (_c: any, next: any) => await next()\nexport const securityLoggingMiddleware: any = () => async (_c: any, next: any) => await next()\nexport const performanceLoggingMiddleware: any = () => async (_c: any, next: any) => await next()\nexport const cacheHeaders: any = () => async (_c: any, next: any) => await next()\nexport const compressionMiddleware: any = async (_c: any, next: any) => await next()\nexport const securityHeaders: any = () => async (_c: any, next: any) => await next()\n\n// Other stubs\nexport const PermissionManager: any = {}\nexport const requirePermission: any = () => async (_c: any, next: any) => await next()\nexport const requireAnyPermission: any = () => async (_c: any, next: any) => await next()\nexport const logActivity: any = () => {}\nexport const requireActivePlugin: any = () => async (_c: any, next: any) => await next()\nexport const requireActivePlugins: any = () => async (_c: any, next: any) => await next()\nexport const getActivePlugins: any = () => []\nexport const isPluginActive: any = () => false\n"]}